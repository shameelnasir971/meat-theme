{%- style -%}
  /* Fonts setup */
  @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@600;700&family=Inter:wght@400;500;600&display=swap');

  .section-{{ section.id }} {
    padding: 80px 0;
    background-color: {{ section.settings.bg_color }};
    font-family: 'Inter', sans-serif;
  }

  .container-{{ section.id }} {
    max-width: 850px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* Header Styles */
  .faq-header-{{ section.id }} { text-align: center; margin-bottom: 50px; }

  .faq-title-{{ section.id }} {
    font-family: 'Oswald', sans-serif;
    font-size: clamp(32px, 5vw, 52px);
    font-weight: 700;
    color: {{ section.settings.text_color_heading }};
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 1px;
    line-height: 1.2;
  }

  .faq-subtitle-{{ section.id }} {
    font-size: 16px;
    color: {{ section.settings.text_color_sub }};
    line-height: 1.6;
    max-width: 650px;
    margin: 0 auto;
  }

  /* FAQ List Wrapper - EK HI LIST HO GI */
  .faq-list-wrapper-{{ section.id }} {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .faq-item-{{ section.id }} {
    background-color: {{ section.settings.inactive_bg }};
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    border: 1px solid rgba(0,0,0,0.02);
  }

  .faq-question-{{ section.id }} {
    padding: 24px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 18px;
    font-weight: 600;
    color: {{ section.settings.inactive_text }};
    transition: 0.3s;
  }

  .faq-icon-box-{{ section.id }} {
    width: 34px;
    height: 34px;
    background-color: #ffffff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: {{ section.settings.active_bg }};
    font-size: 24px;
    font-weight: 400;
    flex-shrink: 0;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  .faq-answer-{{ section.id }} {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease-out, padding 0.3s ease;
    padding: 0 30px;
  }

  .answer-inner-{{ section.id }} { 
    padding-bottom: 25px; 
    font-size: 15px; 
    line-height: 1.7; 
  }

  /* ACTIVE STATE - Jab Sawal Khule ga */
  .faq-item-{{ section.id }}.is-active {
    background-color: {{ section.settings.active_bg }};
    box-shadow: 0 10px 25px rgba(211, 47, 47, 0.15);
  }

  .faq-item-{{ section.id }}.is-active .faq-question-{{ section.id }} { 
    color: {{ section.settings.active_text }}; 
  }

  .faq-item-{{ section.id }}.is-active .faq-answer-{{ section.id }} { 
    max-height: 1000px; /* Bada height takay lambi list bhi fit ho sakay */
  }

  .faq-item-{{ section.id }}.is-active .answer-inner-{{ section.id }} { 
    color: {{ section.settings.active_text }}; 
    opacity: 0.95; 
  }

  @media (max-width: 768px) {
    .section-{{ section.id }} { padding: 50px 0; }
    .faq-question-{{ section.id }} { padding: 18px 20px; font-size: 16px; }
    .faq-icon-box-{{ section.id }} { width: 30px; height: 30px; font-size: 20px; }
  }
{%- endstyle -%}

<section class="section-{{ section.id }}">
  <div class="container-{{ section.id }}">
    
    <!-- Section Title & Subtitle -->
    <div class="faq-header-{{ section.id }}">
      <h2 class="faq-title-{{ section.id }}">{{ section.settings.heading }}</h2>
      <div class="faq-subtitle-{{ section.id }}">{{ section.settings.subheading }}</div>
    </div>

    <!-- FAQ Wrapper - Sari list isi ke andar render hogi -->
    <div class="faq-list-wrapper-{{ section.id }}" id="faqMainContainer-{{ section.id }}">
      
      {%- if section.blocks.size > 0 -%}
        {%- for block in section.blocks -%}
          <div class="faq-item-{{ section.id }} {% if forloop.first %}is-active{% endif %}" {{ block.shopify_attributes }}>
            <div class="faq-question-{{ section.id }}">
              <span>{{ block.settings.question }}</span>
              <div class="faq-icon-box-{{ section.id }}">
                <span class="icon-toggle">{% if forloop.first %}×{% else %}+{% endif %}</span>
              </div>
            </div>
            <div class="faq-answer-{{ section.id }}">
              <div class="answer-inner-{{ section.id }}">
                {{ block.settings.answer }}
              </div>
            </div>
          </div>
        {%- endfor -%}
      {%- else -%}
        {%- comment -%} Demo Placeholder Content {%- endcomment -%}
        {%- for i in (1..4) -%}
          <div class="faq-item-{{ section.id }} {% if forloop.first %}is-active{% endif %}">
            <div class="faq-question-{{ section.id }}">
              <span>Demo Question {{ i }}: Please click "Add Question" block to start adding your content.</span>
              <div class="faq-icon-box-{{ section.id }}"><span class="icon-toggle">{% if forloop.first %}×{% else %}+{% endif %}</span></div>
            </div>
            <div class="faq-answer-{{ section.id }}"><div class="answer-inner-{{ section.id }}">This is placeholder text. Go to your Shopify Theme Customize editor to add real questions and answers.</div></div>
          </div>
        {%- endfor -%}
      {%- endif -%}

    </div>
  </div>
</section>

<script>
(function() {
  const initFaqSection = () => {
    const mainContainer = document.getElementById('faqMainContainer-{{ section.id }}');
    if (!mainContainer) return;

    // Event Delegation: Taki har naye add honay walay block par click kaam karay
    mainContainer.onclick = function(e) {
      const item = e.target.closest('.faq-item-{{ section.id }}');
      if (!item) return;

      const isActive = item.classList.contains('is-active');
      const allItems = mainContainer.querySelectorAll('.faq-item-{{ section.id }}');

      // Sab ko band karo (Accordion mode)
      allItems.forEach(el => {
        el.classList.remove('is-active');
        el.querySelector('.icon-toggle').textContent = '+';
      });

      // Agar pehle band tha, to kholo
      if (!isActive) {
        item.classList.add('is-active');
        item.querySelector('.icon-toggle').textContent = '×';
      }
    };
  };

  // Run on page load and inside editor
  document.addEventListener('DOMContentLoaded', initFaqSection);
  document.addEventListener('shopify:section:load', (e) => {
    if (e.detail.sectionId === '{{ section.id }}') initFaqSection();
  });
  
  // Extra safety for editor re-renders
  if (window.Shopify && window.Shopify.designMode) {
    initFaqSection();
  }
})();
</script>

{% schema %}
{
  "name": "FAQ Pro Accordion",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Frequently Asked Questions" },
    { "type": "richtext", "id": "subheading", "label": "Sub-heading", "default": "<p>Everything you need to know about our premium meat cuts, delivery process, and quality standards.</p>" },
    { "type": "header", "content": "Colors" },
    { "type": "color", "id": "bg_color", "label": "Section Background", "default": "#ffffff" },
    { "type": "color", "id": "active_bg", "label": "Active Background (Red)", "default": "#d32f2f" },
    { "type": "color", "id": "active_text", "label": "Active Text Color", "default": "#ffffff" },
    { "type": "color", "id": "inactive_bg", "label": "Inactive Background (Pink)", "default": "#fdf2f2" },
    { "type": "color", "id": "inactive_text", "label": "Inactive Text Color", "default": "#1a1a1a" },
    { "type": "color", "id": "text_color_heading", "label": "Main Heading Color", "default": "#1a1a1a" },
    { "type": "color", "id": "text_color_sub", "label": "Sub-heading Color", "default": "#666666" }
  ],
  "blocks": [
    {
      "type": "faq",
      "name": "Question Block",
      "settings": [
        { "type": "text", "id": "question", "label": "Question", "default": "Is this product halal certified?" },
        { "type": "richtext", "id": "answer", "label": "Answer", "default": "<p>Yes, the beef is 100% halal and processed according to UAE-approved standards and hygienic practices.</p>" }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ Pro Accordion",
      "blocks": [
        { "type": "faq", "settings": { "question": "Is this product halal certified?" } },
        { "type": "faq", "settings": { "question": "Can I choose the cube size?" } },
        { "type": "faq", "settings": { "question": "How is the meat delivered?" } },
        { "type": "faq", "settings": { "question": "Is the beef fresh or frozen?" } }
      ]
    }
  ]
}
{% endschema %}
