{%- style -%}
/* Import Requested Fonts */
@import url('https://fonts.googleapis.com/css2?family=Questrial&family=Oswald:wght@400;500;700&family=Poppins:wght@300;400;500;600&family=Montserrat:wght@400;700&family=Roboto:wght@400;700&display=swap');

.section-{{ section.id }} {
  --bg-color: {{ section.settings.bg_color }};
  --card-bg: {{ section.settings.card_bg_color }};
  --accent-color: {{ section.settings.accent_color }};
  --heading-color: {{ section.settings.text_color_heading }};
  --sub-color: {{ section.settings.text_color_sub }};
  --quote-color: {{ section.settings.text_color_quote }};
  --author-color: {{ section.settings.text_color_author }};
  
  --h-font: {{ section.settings.heading_font_family }};
  --b-font: {{ section.settings.body_font_family }};
  --h-size: {{ section.settings.heading_size }}px;
  --h-size-mob: {{ section.settings.heading_size_mob }}px;
  --quote-size: {{ section.settings.quote_size }}px;

  padding-top: {{ section.settings.padding_top }}px;
  padding-bottom: {{ section.settings.padding_bottom }}px;
  background-color: var(--bg-color);
  font-family: var(--b-font);
  overflow: hidden;
}

.container-testimonial {
  max-width: {{ section.settings.container_width }}px;
  margin: 0 auto;
  padding: 0 20px;
}

.testimonial-header { 
  text-align: center; margin-bottom: 50px; 
  {% if section.settings.animation_type != 'none' %}
    animation: {{ section.settings.animation_type }} 1s ease-out forwards;
    opacity: 0;
  {% endif %}
}

.testimonial-title {
  font-family: var(--h-font);
  font-size: var(--h-size);
  color: var(--heading-color);
  font-weight: 700;
  text-transform: uppercase;
  margin-bottom: 10px;
}

.testimonial-slider-wrapper { overflow: hidden; position: relative; padding: 10px 0; }

.testimonial-track {
  display: flex;
  transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
  gap: 20px;
}

.testimonial-card {
  flex: 0 0 calc(33.333% - 14px);
  min-width: 300px;
  {% if section.settings.animation_type != 'none' %}
    animation: {{ section.settings.animation_type }} 1s ease-out forwards;
    opacity: 0;
  {% endif %}
}

.card-inner {
  background: var(--card-bg);
  padding: 40px 30px;
  border-radius: {{ section.settings.card_radius }}px;
  position: relative;
  height: 100%;
  display: flex;
  flex-direction: column;
  transition: 0.4s ease;
  border: 1px solid rgba(0,0,0,0.05);
  box-shadow: 0 10px 30px rgba(0,0,0,0.03);
}

{% if section.settings.enable_card_hover %}
.card-inner:hover {
  transform: translateY(-10px);
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  border-color: var(--accent-color);
}
{% endif %}

/* OFF TAG / DYNAMIC BADGE */
.card-badge {
  position: absolute;
  top: 15px; right: 15px;
  padding: 5px 15px;
  background: {{ section.settings.badge_bg }};
  color: {{ section.settings.badge_text_color }};
  font-size: 12px; font-weight: 700;
  border-radius: 50px; text-transform: uppercase;
  font-family: var(--h-font);
}

.quote-icon { width: 35px; margin-bottom: 20px; color: var(--accent-color); }
.quote-text {
  font-size: var(--quote-size);
  color: var(--quote-color);
  line-height: 1.8;
  margin-bottom: 30px;
  font-style: italic;
}

.author-box { display: flex; align-items: center; gap: 15px; margin-top: auto; }
.avatar {
  width: 60px; height: 60px; border-radius: 50%; object-fit: cover;
  border: 2px solid var(--accent-color);
}

.author-info h4 { font-family: var(--h-font); font-size: 18px; margin: 0; color: var(--author-color); }
.author-info p { margin: 0; font-size: 14px; color: var(--sub-color); }

/* SLIDER NAVIGATION (SCREENSHOT STYLE: THIN RED CIRCLE) */
.slider-controls {
  display: flex; justify-content: center; align-items: center; gap: 30px; margin-top: 50px;
}

.nav-btn {
  width: 65px; height: 65px;
  border-radius: 50%;
  border: 1.5px solid var(--accent-color); /* Thin Circle border */
  background: transparent;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: 0.4s ease;
  padding: 0;
}

.nav-btn i, .nav-btn svg {
  color: var(--accent-color); /* Red Arrow icon */
  font-size: 26px;
  transition: 0.3s;
}

.nav-btn:hover { background: var(--accent-color); }
.nav-btn:hover i, .nav-btn:hover svg { color: #ffffff; }
.nav-btn img { width: 30px; height: 30px; object-fit: contain; }

.slider-dots { display: flex; gap: 10px; }
.dot { width: 10px; height: 10px; background: #ddd; border-radius: 50%; cursor: pointer; transition: 0.4s; }
.dot.active { background: var(--accent-color); width: 30px; border-radius: 10px; }

@keyframes fade-up { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
@keyframes zoom-in { from { opacity: 0; transform: scale(0.85); } to { opacity: 1; transform: scale(1); } }

@media (max-width: 1024px) { .testimonial-card { flex: 0 0 calc(50% - 10px); } }
@media (max-width: 767px) { 
  .testimonial-card { flex: 0 0 100%; }
  .testimonial-title { font-size: var(--h-size-mob); }
  .nav-btn { width: 55px; height: 55px; }
}
{%- endstyle -%}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<section class="section-{{ section.id }}">
  <div class="container-testimonial">
    <div class="testimonial-header">
      <h2 class="testimonial-title">{{ section.settings.heading }}</h2>
      <div class="testimonial-subtitle">{{ section.settings.subheading }}</div>
    </div>

    <div class="testimonial-slider-wrapper">
      <div class="testimonial-track" id="track-{{ section.id }}">
        {%- for block in section.blocks -%}
          <div class="testimonial-card" {{ block.shopify_attributes }}>
            <div class="card-inner">
              {% if block.settings.badge_text != blank %}
                <span class="card-badge">{{ block.settings.badge_text }}</span>
              {% endif %}
              
              <div class="quote-icon">
                {% if section.settings.custom_quote_icon != blank %}
                  <img src="{{ section.settings.custom_quote_icon | image_url: width: 50 }}">
                {% else %}
                  <i class="fas fa-quote-left"></i>
                {% endif %}
              </div>

              <p class="quote-text">{{ block.settings.quote }}</p>
              
              <div class="author-box">
                {% if block.settings.image != blank %}
                  <img src="{{ block.settings.image | image_url: width: 150 }}" class="avatar">
                {% else %}
                  <img src="https://i.pravatar.cc/150?u={{ block.id }}" class="avatar">
                {% endif %}
                <div class="author-info">
                  <h4>{{ block.settings.name }}</h4>
                  <p>{{ block.settings.location }}</p>
                </div>
              </div>
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>

    <div class="slider-controls">
      <button class="nav-btn prev-{{ section.id | replace: '-', '' }}" onclick="slider{{ section.id | replace: '-', '' }}.move(-1)">
        {% if section.settings.custom_icon_left != blank %}
          <img src="{{ section.settings.custom_icon_left | image_url: width: 44 }}">
        {% else %}
          <i class="fas fa-chevron-left"></i>
        {% endif %}
      </button>

      <div class="slider-dots" id="dots-{{ section.id }}"></div>

      <button class="nav-btn next-{{ section.id | replace: '-', '' }}" onclick="slider{{ section.id | replace: '-', '' }}.move(1)">
        {% if section.settings.custom_icon_right != blank %}
          <img src="{{ section.settings.custom_icon_right | image_url: width: 44 }}">
        {% else %}
          <i class="fas fa-chevron-right"></i>
        {% endif %}
      </button>
    </div>
  </div>
</section>

<script>
class TestiSlider{{ section.id | replace: '-', '' }} {
  constructor() {
    this.track = document.getElementById('track-{{ section.id }}');
    this.dotsBox = document.getElementById('dots-{{ section.id }}');
    this.index = 0;
    this.init();
  }
  getVisible() {
    if (window.innerWidth <= 767) return 1;
    if (window.innerWidth <= 1024) return 2;
    return 3;
  }
  init() {
    this.renderDots();
    window.addEventListener('resize', () => { this.index = 0; this.renderDots(); this.update(); });
  }
  renderDots() {
    const cards = this.track.querySelectorAll('.testimonial-card');
    const count = Math.max(0, cards.length - this.getVisible() + 1);
    this.dotsBox.innerHTML = '';
    for(let i=0; i<count; i++) {
      const dot = document.createElement('div');
      dot.className = `dot ${i===this.index ? 'active' : ''}`;
      dot.onclick = () => { this.index = i; this.update(); };
      this.dotsBox.appendChild(dot);
    }
  }
  move(dir) {
    const cards = this.track.querySelectorAll('.testimonial-card');
    const max = Math.max(0, cards.length - this.getVisible());
    this.index += dir;
    if(this.index < 0) this.index = max;
    else if(this.index > max) this.index = 0;
    this.update();
  }
  update() {
    const w = this.track.querySelector('.testimonial-card').offsetWidth + 20;
    this.track.style.transform = `translateX(-${this.index * w}px)`;
    const dots = this.dotsBox.querySelectorAll('.dot');
    dots.forEach((d, i) => d.classList.toggle('active', i === this.index));
  }
}
const slider{{ section.id | replace: '-', '' }} = new TestiSlider{{ section.id | replace: '-', '' }}();
</script>

{% schema %}
{
  "name": "Testimonials Slider Pro",
  "settings": [
    { "type": "header", "content": "Text Content" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Customer Feedback" },
    { "type": "richtext", "id": "subheading", "label": "Sub-heading", "default": "<p>Read what our happy clients have to say.</p>" },

    { "type": "header", "content": "Typography (Advanced Fonts)" },
    { "type": "select", "id": "heading_font_family", "label": "Heading Font", "options": [
      { "value": "'Oswald', sans-serif", "label": "Oswald (Bold)" },
      { "value": "'Questrial', sans-serif", "label": "Questrial (Clean)" },
      { "value": "'Poppins', sans-serif", "label": "Poppins" },
      { "value": "'Montserrat', sans-serif", "label": "Montserrat" }
    ], "default": "'Oswald', sans-serif" },
    { "type": "select", "id": "body_font_family", "label": "Body Font", "options": [
      { "value": "'Poppins', sans-serif", "label": "Poppins" },
      { "value": "'Roboto', sans-serif", "label": "Roboto" },
      { "value": "'Questrial', sans-serif", "label": "Questrial" }
    ], "default": "'Poppins', sans-serif" },
    { "type": "range", "id": "heading_size", "label": "Heading Size", "min": 20, "max": 80, "step": 1, "default": 42 },
    { "type": "range", "id": "heading_size_mob", "label": "Heading Size Mobile", "min": 18, "max": 40, "step": 1, "default": 28 },
    { "type": "range", "id": "quote_size", "label": "Quote Text Size", "min": 12, "max": 24, "step": 1, "default": 16 },

    { "type": "header", "content": "Colors & Badges" },
    { "type": "color", "id": "bg_color", "label": "Section Background", "default": "#ffffff" },
    { "type": "color", "id": "card_bg_color", "label": "Card Background", "default": "#fdf0f0" },
    { "type": "color", "id": "accent_color", "label": "Accent Color (Arrows/Dots)", "default": "#d32f2f" },
    { "type": "color", "id": "text_color_heading", "label": "Heading Color", "default": "#1a1a1a" },
    { "type": "color", "id": "text_color_sub", "label": "Sub-heading Color", "default": "#555555" },
    { "type": "color", "id": "text_color_quote", "label": "Quote Color", "default": "#333333" },
    { "type": "color", "id": "text_color_author", "label": "Author Name Color", "default": "#d32f2f" },
    { "type": "color", "id": "badge_bg", "label": "Tag/Badge Background", "default": "#d32f2f" },
    { "type": "color", "id": "badge_text_color", "label": "Tag/Badge Text", "default": "#ffffff" },

    { "type": "header", "content": "Custom Device Icons" },
    { "type": "image_picker", "id": "custom_quote_icon", "label": "Custom Quote Icon" },
    { "type": "image_picker", "id": "custom_icon_left", "label": "Custom Left Arrow" },
    { "type": "image_picker", "id": "custom_icon_right", "label": "Custom Right Arrow" },

    { "type": "header", "content": "Animations & Hover" },
    { "type": "select", "id": "animation_type", "label": "Entrance Animation", "options": [
      { "value": "none", "label": "None" },
      { "value": "fade-up", "label": "Fade Up" },
      { "value": "zoom-in", "label": "Zoom In" }
    ], "default": "fade-up" },
    { "type": "checkbox", "id": "enable_card_hover", "label": "Enable Card Lift on Hover", "default": true },

    { "type": "header", "content": "Layout Spacing" },
    { "type": "range", "id": "container_width", "label": "Container Width", "min": 1000, "max": 1600, "step": 10, "default": 1240 },
    { "type": "range", "id": "card_radius", "label": "Card Corner Radius", "min": 0, "max": 50, "step": 1, "default": 20 },
    { "type": "range", "id": "padding_top", "label": "Padding Top", "min": 0, "max": 150, "step": 2, "default": 80 },
    { "type": "range", "id": "padding_bottom", "label": "Padding Bottom", "min": 0, "max": 150, "step": 2, "default": 80 }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "text", "id": "badge_text", "label": "Card Tag (e.g. 20% OFF / NEW)", "default": "Verified" },
        { "type": "textarea", "id": "quote", "label": "Quote Text", "default": "Absolutely fantastic quality! Highly recommended." },
        { "type": "image_picker", "id": "image", "label": "Author Photo" },
        { "type": "text", "id": "name", "label": "Author Name", "default": "Zeeshan Ahmed" },
        { "type": "text", "id": "location", "label": "Designation/Location", "default": "Customer" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials Slider Pro",
      "blocks": [ { "type": "testimonial" }, { "type": "testimonial" }, { "type": "testimonial" } ]
    }
  ]
}
{% endschema %}